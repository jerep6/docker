= Docker

== Registry privé

J'utilise un registry privé afin de déposer mes images docker.
Depuis l'extérieur, ce registry est accessible via un tunnel SSH.

image::archi.png[align="center"]

**Installer le registry**

Le registry est fourni sous forme d'une image docker.

  docker pull registry:2.0.1

**Lancer le registry**

    docker run --name="registry2" -d -p 5000:5000 -v /mnt/stockage1/docker/registry2:/data -e STORAGE_PATH=/data registry:2.0.1

    
**Connexion au registry**

    ssh serveur –L 5000:localhost:5000

    
**Déposer une image dans ce registry**

   docker push localhost:5000/acimflo-ddclient

L'username de l'image doit être remplacé par l'url du registry. Pour faire la différence entre un nom d'utilisateur et une url, docker analyse la présence de "." ou de ":"
Le nom du tag de l'image doit être de la sorte URL_REGISTRY/NOM_IMAGE

Le tag peut s'effectuer soit au moment du build, soit après via la commande _docker tag_:
   
   docker build -t localhost:5000/acimflo-ddclient .
   docker tag 8dbd9e392a96 localhost:5000/acimflo-ddclient

**Marche à suive**

+++Sur la machine de travail+++

. tagguer l'image avec le nom du repository privé (localhost:5000 dans mon cas)
	docker tag -f 41e0dd6ab219 localhost:5000/jenkins
.Envoyer l'image sur le repo privé
	docker push localhost:5000/jenkins

+++Sur le serveur+++

. Récupérer l'image sur le serveur à partir du repo privé
	docker pull localhost:5000/jenkins
. Lancer le container correspondant à la nouvelle image


